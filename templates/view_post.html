{% extends "base.html" %}
{% block title %}{{ post.title }} — DevVault{% endblock %}
{% block content %}
<div class="container-md">
    <!-- Breadcrumb -->
    <div style="font-size:0.8125rem;color:var(--text-secondary);margin-bottom:1rem;">
        <a href="{{ url_for('profile', user_id=post.user_id) }}" style="color:var(--text-link);">{{ post.username }}</a>
        <span style="margin:0 0.375rem;">/</span>
        <strong style="color:var(--text-primary);">{{ post.title }}</strong>
        {% if post.is_private %}<span class="label label-gray" style="margin-left:0.5rem;">Private</span>{% endif %}
    </div>

    <!-- Snippet box -->
    <div class="code-block mb-3">
        <div class="code-block-header">
            <div class="d-flex align-center gap-sm">
                <div class="avatar avatar-xs">{{ post.username[0]|upper }}</div>
                <span>
                    <a href="{{ url_for('profile', user_id=post.user_id) }}"
                        style="font-weight:600;color:var(--text-primary);">{{ post.username }}</a>
                    <span style="color:var(--text-secondary);"> created this snippet</span>
                    <span style="color:var(--text-muted);">· {{ post.created_at[:10] if post.created_at else ''
                        }}</span>
                </span>
            </div>
        </div>
        <div class="code-block-body">{{ post.content | safe }}</div>
    </div>

    <!-- Comments -->
    <div>
        <h2 style="font-size:1rem;font-weight:600;margin-bottom:1rem;">{{ comments|length }} comment{% if
            comments|length != 1 %}s{% endif %}</h2>

        <div class="comment-thread">
            {% for comment in comments %}
            <div class="comment">
                <div class="avatar avatar-sm">{{ comment.username[0]|upper }}</div>
                <div class="comment-body-wrap">
                    <div class="comment-header">
                        <span class="comment-author">{{ comment.username }}</span>
                        <span class="comment-date">{{ comment.created_at[:10] if comment.created_at else '' }}</span>
                    </div>
                    <div class="comment-body">{{ comment.content | safe }}</div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if session.user_id %}
        <div class="comment-form">
            <div class="avatar avatar-sm">{{ session.username[0]|upper }}</div>
            <div class="comment-form-body">
                <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}" id="comment-form">
                    <div class="form-group">
                        <textarea name="content" class="form-textarea" rows="3"
                            placeholder="Leave a comment..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm" id="submit-comment-btn">Comment</button>
                </form>
            </div>
        </div>
        {% else %}
        <div
            style="margin-top:1.5rem;padding:1rem;background:var(--bg-subtle);border:1px solid var(--border);border-radius:var(--radius-md);font-size:0.875rem;color:var(--text-secondary);">
            <a href="{{ url_for('login') }}">Sign in</a> to leave a comment.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}